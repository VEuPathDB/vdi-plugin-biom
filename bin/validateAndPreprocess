#!/usr/bin/env python3

import sys
import subprocess
sys.path.insert(0, "/opt/veupathdb/lib/python")
from BiomFileImporter import BiomImporter

def usage():
    msg = """
Validate and prepare a biom file to be imported.  

Generates metadata.json and data.tsv files, and writes them to output_dir

Usage:  validateAndPreprocess input_dir output_dir

Where:
 - input_dir:  must contain exactly one biom format file
 - output_dir: where the processed files will be written

exit 1 if the input is not valid
exit 2 if there is a system err
"""
    print(msg, file=sys.stderr)
    sys.exit(2)

def main():
    if len(sys.argv) != 3:
        usage()
    inputDir = sys.argv[1]
    outputDir = sys.argv[2]
    importer = BiomImporter()

    # validate the biom file, and generate output files.  Exits with status 1 if invalid (and 2 if system error)
    importer.importBiom(inputDir, outputDir)

if __name__ == "__main__":
    sys.exit(main())


